---
title: Skunk新特性（Arena内存池）
categories:
  - skunk
tags:
  - skunk
  - design
abbrlink: a9e7
date: 2020-04-19 06:29:52
---

Skunk 如何更好地管理内存 [@leemaster](https://www.github.com/leemaster)

<!--more-->

# 堆内存上的麻烦事

还记得在零几年的时候，C++虽然有坑，但是不至于被各种喷，慢慢地计算机性能开始提高，尤其是出现了多核处理器，这个时候，令人脑壳疼的事情就出现了，在C/C++这种完全依靠程序员自己手工管内存的语言中，各种奇妙的问题就出来，究其原因其实还是因为`malloc`在进程空间内进行内存分配，也就是这个函数其实在内部会走到一个临界区，一旦并发程序跑起来，事情就变得脑壳疼起来了。

然后各家公司就自己制造了很多有意思的轮子`jemalloc`、`tcmalloc`，在写Skunk的时候，我觉得我应该还没有完全的掌控C++这个神奇的语言，毕竟很少有机会自己去研究内存的申请和释放，当然Skunk的实现上直接在`accept`的时候，就建立好了内存，这个过程是单线程的，后来思考了一下，其实在多线程`accept`情况下，其实也没啥大问题，毕竟多线程就会面临惊群问题。



